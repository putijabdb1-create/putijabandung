<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Login Teknisi â€“ PT PUTRA TIMUR JAYA BDB1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
body{font-family:Poppins,sans-serif;background:#020617;color:#fff;margin:0}
.page{max-width:1100px;margin:auto;padding:20px}
.card{background:#020617;border:1px solid #1f2937;border-radius:16px;padding:18px}
.grid{display:grid;grid-template-columns:1fr 1.5fr;gap:20px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
label{font-size:12px}
input,select,textarea{width:100%;margin:6px 0 10px;padding:8px;border-radius:8px;border:1px solid #374151;background:#020617;color:#fff}
button{padding:8px 14px;border-radius:20px;border:none;font-weight:600;cursor:pointer}
.primary{background:#2563eb;color:#fff}
.secondary{background:transparent;border:1px solid #555;color:#fff}
.danger{background:#dc2626;color:#fff}
.preview-small{max-width:120px;margin-top:6px;border-radius:8px;display:none}
.biodata-page{background:#fff;color:#000;padding:20px}
.bio-table{width:100%;border-collapse:collapse;font-size:11px}
.bio-table td{border:1px solid #ccc;padding:4px}
</style>
</head>

<body>
<main class="page">

<h2>Login Teknisi</h2>

<div class="grid">
<!-- LOGIN -->
<div class="card">
<label>User ID</label>
<input id="loginUser">
<label>Password</label>
<input id="loginPass" type="password">
<button class="primary" onclick="loginTeknisi()">Login</button>
<p id="loginStatus"></p>
</div>

<!-- FORM -->
<div class="card" id="formCard" style="display:none">
<label>Nama Pegawai</label>
<input id="namaPegawai">

<label>Tempat / Tanggal Lahir</label>
<input id="ttl">

<label>Jenis Kelamin</label>
<select id="jenisKelamin">
<option value="">-- pilih --</option>
<option>Laki-laki</option>
<option>Perempuan</option>
</select>

<label>Divisi</label>
<input id="divisi">

<label>Lokasi Kerja</label>
<input id="lokasiKerja">

<label>Foto Teknisi</label>
<input type="file" id="fotoTeknisi">
<img id="previewFotoForm" class="preview-small">

<button class="primary" onclick="saveBiodata()">Simpan</button>
<button class="secondary" onclick="showPreviewBiodata()">Preview</button>
<button class="danger" onclick="logoutTeknisi()">Logout</button>

<p id="formStatus"></p>
</div>
</div>

<!-- PREVIEW -->
<div id="previewWrapper" style="display:none;margin-top:30px">
<div class="biodata-page">
<h3>BIODATA PEGAWAI</h3>
<table class="bio-table">
<tr><td>Nama</td><td id="pvNamaPegawai"></td></tr>
<tr><td>TTL</td><td id="pvTtl"></td></tr>
<tr><td>Jenis Kelamin</td><td id="pvJenisKelamin"></td></tr>
<tr><td>Foto</td><td><<img id="bioFotoInline"style="max-width:120px; display:none; border:1px solid #000;">
></td></tr>
</table>
<p id="pvPrintedAt"></p>
</div>
</div>

</main>

<script>
/* ================= KONFIG ================= */
const WEB_APP_URL="https://script.google.com/macros/s/AKfycbzfYMYq83BYCNxITAK-CbGQ0uA5diRWuFw1-kyd7zzqmcFR_3hwWnHtNNDLTF4mUHc/exec";

/* ================= USERS ================= */
let USERS=[
"PTJ_Arip007|alvaro007|15889311|ARIP RAHMATULLOH|PIC|CMI"
].map(l=>{
const[a,b,c,d,e,f]=l.split("|");
return{username:a,password:b,nik:c,nama:d,divisi:e,defaultArea:f};
});

let currentUser=null;
let fotoDataUrl="";

/* ================= LOGIN ================= */
function loginTeknisi(){
const u=loginUser.value.trim();
const p=loginPass.value.trim();
const s=loginStatus;

const user=USERS.find(x=>x.username===u&&x.password===p);
if(!user){s.textContent="Login gagal";s.style.color="red";return;}

currentUser=user;
s.textContent="Login berhasil";
s.style.color="green";

namaPegawai.value=user.nama;
divisi.value=user.divisi;
lokasiKerja.value=user.defaultArea;
formCard.style.display="block";
}

function logoutTeknisi(){
currentUser=null;
formCard.style.display="none";
previewWrapper.style.display="none";
}

/* ================= FOTO ================= */
fotoTeknisi.onchange=e=>{
const r=new FileReader();
r.onload=x=>{
fotoDataUrl=x.target.result;
previewFotoForm.src=x.target.result;
previewFotoForm.style.display="block";
};
r.readAsDataURL(e.target.files[0]);
};

/* ================= SAVE ================= */
async function saveBiodata(){
if(!currentUser) return alert("Login dulu");
formStatus.textContent="Menyimpan...";

await fetch(WEB_APP_URL,{
method:"POST",
headers:{"Content-Type":"text/plain;charset=utf-8"},
body:JSON.stringify({
mode:"saveBiodata",
user:currentUser,
biodata:{
namaPegawai:namaPegawai.value,
ttl:ttl.value,
jenisKelamin:jenisKelamin.value,
divisi:divisi.value,
lokasiKerja:lokasiKerja.value
},
foto:fotoDataUrl
})
});

formStatus.textContent="Tersimpan";
}

/* ================= PREVIEW ================= */
async function showPreviewBiodata(){
let data={},photos={};

const r=await fetch(WEB_APP_URL,{
method:"POST",
headers:{"Content-Type":"text/plain;charset=utf-8"},
body:JSON.stringify({mode:"getBiodata",username:currentUser.username})
});
const j=await r.json();
if(j.ok&&j.found){data=j.biodata;photos=j.photos;}

pvNamaPegawai.textContent=data.namaPegawai||"-";
pvTtl.textContent=data.ttl||"-";
pvJenisKelamin.textContent=data.jenisKelamin||"-";

if (photos.fotoTeknisi) {
  bioFotoInline.src = photos.fotoTeknisi;
  bioFotoInline.style.display = "block";
} else {
  bioFotoInline.style.display = "none";
}

pvPrintedAt.textContent=new Date().toLocaleString("id-ID");
previewWrapper.style.display="block";
}
</script>

</body>
</html>

