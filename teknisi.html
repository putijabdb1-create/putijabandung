<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Login Teknisi â€“ PT PUTRA TIMUR JAYA BDB1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!--
  =================================================
   teknisi.html
   Versi  : v1.0 â€“ STABLE (FINAL)
   Update : 2025
   Catatan:
   - Tambahan No SIM C & Foto SIM C
   - Preview A4 lengkap
   - Data lama bisa muncul & diedit
   - Jangan ubah struktur tanpa backup
  =================================================
  -->

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Poppins", sans-serif;
      background: radial-gradient(circle at top left, #22c55e22, transparent 50%),
                  radial-gradient(circle at bottom right, #4f46e522, transparent 55%),
                  linear-gradient(135deg, #020617, #020617 40%, #020617);
      color: #f9fafb;
      min-height: 100vh;
    }
    a { text-decoration: none; color: inherit; }

    .page {
      max-width: 1120px;
      margin: 0 auto;
      padding: 18px 18px 40px;
    }

    /* ===== NAVBAR ===== */
    .navbar {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(20px);
      background: linear-gradient(to right, #020617cc, #020617dd);
      border-bottom: 1px solid #1f2937;
    }
    .nav-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 10px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .nav-brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .nav-brand-logo {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: radial-gradient(circle, #4ade80, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 1px solid #22c55e88;
      color: #022c22;
      font-size: 14px;
      font-weight: 700;
    }
    .nav-brand-title span:first-child {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #9ca3af;
    }
    .nav-brand-title span:last-child {
      font-size: 13px;
      font-weight: 600;
    }

    /* ===== LAYOUT ===== */
    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.4fr);
      gap: 20px;
      margin-top: 26px;
    }
    @media (max-width: 900px) {
      .grid-2 { grid-template-columns: 1fr; }
    }

    .card {
      background: #020617;
      border-radius: 18px;
      padding: 18px;
      border: 1px solid #1f2937;
      box-shadow: 0 16px 45px rgba(15,23,42,0.85);
    }

    label {
      font-size: 12px;
      display: block;
      margin-bottom: 4px;
      color: #e5e7eb;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #374151;
      background: #020617;
      color: #f9fafb;
      font-size: 12px;
      outline: none;
      margin-bottom: 8px;
    }

    .btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-primary {
      background: linear-gradient(135deg,#2563eb,#1d4ed8);
      color: #f9fafb;
    }

    .preview-small {
      margin-top: 6px;
      max-width: 120px;
      border-radius: 10px;
      display: none;
      border: 1px solid #1f2937;
    }

    /* ===== PREVIEW A4 ===== */
    .biodata-page {
      width: 210mm;
      min-height: 297mm;
      margin: 0 auto;
      padding: 18mm 20mm;
      background: #ffffff;
      color: #000000;
      font-size: 11px;
    }
    .bio-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4px;
    }
    .bio-table td {
      border: 1px solid #00000033;
      padding: 3px 6px;
      vertical-align: top;
    }
    .bio-table td.label { width: 35%; font-weight: 500; }
  </style>
</head>

  <!--======PART 1======== -->
  
  <body>

  <!-- ================= NAVBAR ================= -->
  <header class="navbar">
    <div class="nav-inner">
      <div class="nav-brand">
        <div class="nav-brand-logo">P</div>
        <div class="nav-brand-title">
          <span>PT PUTRA TIMUR JAYA</span>
          <span>BANDUNG BARAT 1</span>
        </div>
      </div>
      <ul class="nav-links">
        <li><a href="index.html">Beranda</a></li>
        <li><a href="program.html">Program</a></li>
        <li><a href="galeri.html">Galeri</a></li>
        <li><a href="teknisi.html" class="active">Login Teknisi</a></li>
        <li><a href="kontak.html">Kontak</a></li>
      </ul>
    </div>
  </header>

  <main class="page">

    <h1 style="font-size:18px;font-weight:600;">Login Teknisi</h1>
    <p style="font-size:12px;color:#9ca3af;margin-top:4px;">
      Halaman khusus teknisi PT PUTRA TIMUR JAYA BDB1.
    </p>

    <div class="grid-2">

      <!-- ================= LOGIN ================= -->
      <div class="card login-card">
        <h2>Login Teknisi</h2>

        <label for="loginUser">User ID</label>
        <input id="loginUser" />

        <label for="loginPass">Password</label>
        <input id="loginPass" type="password" />

        <button class="btn btn-primary" onclick="loginTeknisi()">ðŸ”‘ Login</button>
        <p id="loginStatus" style="font-size:11px;margin-top:6px;"></p>
      </div>

      <!-- ================= FORM BIODATA ================= -->
      <div class="card form-card" id="formCard" style="display:none;">
        <h2>Form Biodata Teknisi</h2>

        <!-- ===== DATA PRIBADI ===== -->
        <div class="section-title">Data Pribadi</div>

        <label>Nama Pegawai</label>
        <input id="namaPegawai" />

        <label>Tempat / Tanggal Lahir</label>
        <input id="ttl" />

        <label>Jenis Kelamin</label>
        <select id="jenisKelamin">
          <option value="">-- Pilih --</option>
          <option>Laki-laki</option>
          <option>Perempuan</option>
        </select>

        <!-- ===== KONTAK ===== -->
        <div class="section-title">Kontak</div>

        <label>No Handphone</label>
        <input id="noHp" />

        <label>Email</label>
        <input id="email" />

        <!-- ===== TAMBAHAN SIM C ===== -->
        <div class="section-title">SIM</div>

        <label for="noSimC">Nomor SIM C</label>
        <input id="noSimC" />

        <label for="fotoSimC">Foto SIM C</label>
        <input id="fotoSimC" type="file" accept="image/*" />
        <img id="previewFotoSimC" class="preview-small" />

        <!-- ===== BUTTON ===== -->
        <div style="margin-top:12px;">
          <button class="btn btn-primary" onclick="saveBiodata()">ðŸ’¾ Simpan</button>
          <button class="btn" onclick="showPreviewBiodata()">ðŸ‘€ Preview</button>
          <button class="btn" onclick="logoutTeknisi()">ðŸšª Logout</button>
        </div>

        <p id="formStatus" style="font-size:11px;margin-top:6px;"></p>
      </div>

    </div>
	
    <!--======PART 2======== -->
	
	    <!-- ================= PREVIEW BIODATA A4 ================= -->
    <div id="previewWrapper" style="display:none;margin-top:30px;">

      <div class="biodata-page" id="biodataPrintArea">

        <div style="text-align:center;margin-bottom:10px;">
          <h1 style="font-size:14px;font-weight:700;">BIODATA PEGAWAI</h1>
          <h2 style="font-size:12px;">PT PUTRA TIMUR JAYA</h2>
        </div>
		<!-- ===== FOTO DOKUMEN ===== -->
			<div class="bio-section" style="margin-top:14px;">
			<div class="bio-section-title">Foto Dokumen</div>
			<table class="bio-table">
			<tr><td class="label">Foto Pegawai</td><td><img id="bioFotoTeknisi"></td></tr>
			<tr><td class="label">KTP</td><td><img id="bioFotoKtp"></td></tr>
			<tr><td class="label">NPWP</td><td><img id="bioFotoNpwp"></td></tr>
			<tr><td class="label">BPJS Ketenagakerjaan</td><td><img id="bioFotoBpjsKet"></td></tr>
			<tr><td class="label">BPJS Kesehatan</td><td><img id="bioFotoBpjsKes"></td></tr>
			<tr><td class="label">Kartu Keluarga</td><td><img id="bioFotoKk"></td></tr>
			<tr><td class="label">SIM C</td><td><img id="bioFotoSimC"></td></tr>
			</table>
			</div>

        <!-- ===== DATA PRIBADI ===== -->
        <div class="bio-section">
          <div class="bio-section-title">Data Pribadi</div>
          <table class="bio-table">
            <tr>
              <td class="label">Nama Pegawai</td>
              <td class="value" id="pvNamaPegawai"></td>
            </tr>
            <tr>
              <td class="label">Tempat / Tanggal Lahir</td>
              <td class="value" id="pvTtl"></td>
            </tr>
            <tr>
              <td class="label">Jenis Kelamin</td>
              <td class="value" id="pvJenisKelamin"></td>
            </tr>
          </table>
        </div>

        <!-- ===== KONTAK ===== -->
        <div class="bio-section" style="margin-top:14px;">
          <div class="bio-section-title">Kontak</div>
          <table class="bio-table">
            <tr>
              <td class="label">Nomor Handphone</td>
              <td class="value" id="pvNoHp"></td>
            </tr>
            <tr>
              <td class="label">Email</td>
              <td class="value" id="pvEmail"></td>
            </tr>
          </table>
        </div>

        <!-- ===== SIM C (TAMBAHAN) ===== -->
        <div class="bio-section" style="margin-top:14px;">
          <div class="bio-section-title">SIM</div>
          <table class="bio-table">
            <tr>
              <td class="label">Nomor SIM C</td>
              <td class="value" id="pvNoSimC"></td>
            </tr>
            <tr>
              <td class="label">Foto SIM C</td>
              <td class="value">
                <img id="bioFotoSimC" style="max-width:40mm;border:1px solid #00000055;" />
              </td>
            </tr>
          </table>
        </div>

        <div style="margin-top:16px;font-size:10px;text-align:right;color:#555;">
          Dicetak pada: <span id="pvPrintedAt"></span>
        </div>

      </div>

      <!-- ===== BUTTON CETAK ===== -->
      <div style="margin-top:10px;text-align:right;">
        <button class="btn btn-primary" onclick="window.print()">ðŸ–¨ Cetak / PDF</button>
      </div>

    </div>

  </main>
	<!--======PART 3======== -->
	
	
	<script>
/* =================================================
   KONFIGURASI
================================================= */
const WEB_APP_URL = "https://script.google.com/macros/s/ISI_WEB_APP_KAMU/exec";

/* =================================================
   STATE GLOBAL
================================================= */
let currentUser = null;

/* FOTO BASE64 */
let fotoDataUrl = "";
let fotoKtpDataUrl = "";
let fotoNpwpDataUrl = "";
let fotoBpjsKetDataUrl = "";
let fotoBpjsKesDataUrl = "";
let fotoKkDataUrl = "";
let fotoSimCDataUrl = "";

/* =================================================
   LOGIN TEKNISI â€“ FINAL (USER_LINES + LOAD DATA)
================================================= */
function loginTeknisi() {
  const userId = document.getElementById("loginUser").value.trim();
  const pass   = document.getElementById("loginPass").value.trim();
  const status = document.getElementById("loginStatus");

  if (!userId || !pass) {
    status.textContent = "PTJ_Arip007 || Alvaro007.";
    status.style.color = "#fca5a5";
    return;
  }

  // === CARI USER DI USER_LINES ===
  const user = USERS.find(
    u => u.username === userId && u.password === pass
  );

  if (!user) {
    status.textContent = "Login gagal: User ID atau password salah.";
    status.style.color = "#fca5a5";
    return;
  }

  // === LOGIN BERHASIL ===
  currentUser = user;

  status.textContent =
    "Login berhasil sebagai " + user.nama + ". Mengambil biodata...";
  status.style.color = "#bbf7d0";

  // tampilkan form
  document.getElementById("formCard").style.display = "block";

  // autofill awal
  document.getElementById("namaPegawai").value = user.nama || "";
  document.getElementById("divisi").value = user.divisi || "";
  document.getElementById("lokasiKerja").value = user.defaultArea || "";

  /* ===== AMBIL DATA LAMA + FOTO ===== */
  fetch(WEB_APP_URL + "?mode=getBiodata&nik=" + user.nik)
    .then(r => r.json())
    .then(res => {
      if (!res.ok) return;

      // isi form lama
      if (typeof fillFormFromData === "function") {
        fillFormFromData(res.biodata || {});
      }

      // isi foto lama
      fotoDataUrl        = res.photos.teknisi || "";
      fotoKtpDataUrl     = res.photos.ktp || "";
      fotoNpwpDataUrl    = res.photos.npwp || "";
      fotoBpjsKetDataUrl = res.photos.bpjsKet || "";
      fotoBpjsKesDataUrl = res.photos.bpjsKes || "";
      fotoKkDataUrl      = res.photos.kk || "";
      fotoSimCDataUrl    = res.photos.simc || "";

      document.getElementById("formStatus").textContent =
        "Biodata & foto sebelumnya ditemukan. Silakan cek atau edit.";
    })
    .catch(err => {
      console.error("Get biodata error:", err);
    });
}


/* =================================================
   LOGOUT
================================================= */
function logoutTeknisi() {
  currentUser = null;

  document.getElementById("formCard").style.display = "none";
  document.getElementById("previewWrapper").style.display = "none";
  document.getElementById("loginUser").value = "";
  document.getElementById("loginPass").value = "";
  document.getElementById("loginStatus").textContent = "";

  // reset foto
  fotoDataUrl = "";
  fotoKtpDataUrl = "";
  fotoNpwpDataUrl = "";
  fotoBpjsKetDataUrl = "";
  fotoBpjsKesDataUrl = "";
  fotoKkDataUrl = "";
  fotoSimCDataUrl = "";
}

/* =================================================
   FILE PREVIEW HANDLER
================================================= */
function attachFilePreview(inputId, imgId, setter) {
  const input = document.getElementById(inputId);
  const img = document.getElementById(imgId);
  if (!input || !img) return;

  input.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = ev => {
      setter(ev.target.result);
      img.src = ev.target.result;
      img.style.display = "block";
    };
    reader.readAsDataURL(file);
  });
}

/* FOTO YANG ADA */
attachFilePreview("fotoTeknisi", "previewFotoForm", v => fotoDataUrl = v);
attachFilePreview("fotoKtp", "previewFotoKtp", v => fotoKtpDataUrl = v);
attachFilePreview("fotoNpwp", "previewFotoNpwp", v => fotoNpwpDataUrl = v);
attachFilePreview("fotoBpjsKet", "previewFotoBpjsKet", v => fotoBpjsKetDataUrl = v);
attachFilePreview("fotoBpjsKes", "previewFotoBpjsKes", v => fotoBpjsKesDataUrl = v);
attachFilePreview("fotoKk", "previewFotoKk", v => fotoKkDataUrl = v);
attachFilePreview("fotoSimC", "previewFotoSimC", v => fotoSimCDataUrl = v);

/* =================================================
   KUMPUL DATA FORM
================================================= */
function collectFormData() {
  return {
    namaPegawai: document.getElementById("namaPegawai").value || "",
    ttl: document.getElementById("ttl").value || "",
    jenisKelamin: document.getElementById("jenisKelamin").value || "",
    noHp: document.getElementById("noHp").value || "",
    email: document.getElementById("email").value || "",
    noSimC: document.getElementById("noSimC").value || ""
  };
}

/* =================================================
   PREVIEW A4 (SEMUA DATA & FOTO) - FINAL
================================================= */
function showPreviewBiodata() {

  const v = id => document.getElementById(id)?.value || "-";
  const t = (id, val) => {
    const el = document.getElementById(id);
    if (el) el.textContent = val || "-";
  };

  const img = (id, src) => {
    const el = document.getElementById(id);
    if (!el) return;
    if (src) {
      el.src = src;
      el.style.display = "block";
    } else {
      el.style.display = "none";
    }
  };

  /* ===== DATA TEKS ===== */
  t("pvNamaPegawai", v("namaPegawai"));
  t("pvTtl", v("ttl"));
  t("pvJenisKelamin", v("jenisKelamin"));
  t("pvNoHp", v("noHp"));
  t("pvEmail", v("email"));
  t("pvNoSimC", v("noSimC"));

  /* ===== FOTO (FORM / DATA LAMA) ===== */
  img("bioFotoTeknisi", fotoDataUrl);
  img("bioFotoKtp", fotoKtpDataUrl);
  img("bioFotoNpwp", fotoNpwpDataUrl);
  img("bioFotoBpjsKet", fotoBpjsKetDataUrl);
  img("bioFotoBpjsKes", fotoBpjsKesDataUrl);
  img("bioFotoKk", fotoKkDataUrl);
  img("bioFotoSimC", fotoSimCDataUrl);

  /* ===== FOOTER ===== */
  const printedAt = document.getElementById("pvPrintedAt");
  if (printedAt) {
    printedAt.textContent = new Date().toLocaleString("id-ID");
  }

  document.getElementById("previewWrapper").style.display = "block";
  document.getElementById("previewWrapper")
    .scrollIntoView({ behavior: "smooth" });
}

/* =================================================
   SIMPAN BIODATA
================================================= */
async function saveBiodata() {
  if (!currentUser) {
    alert("Silakan login terlebih dahulu");
    return;
  }

  const data = collectFormData();
  const status = document.getElementById("formStatus");

  status.textContent = "Menyimpan data...";
  status.style.color = "#9ca3af";

  try {
    await fetch(WEB_APP_URL, {
      method: "POST",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify({
        mode: "saveBiodata",
        user: currentUser,
        biodata: data,
        fotoSimC: fotoSimCDataUrl
      })
    });

    status.textContent = "Data berhasil disimpan.";
    status.style.color = "#22c55e";

    showPreviewBiodata();

  } catch (err) {
    status.textContent = "Gagal menyimpan data";
    status.style.color = "#fca5a5";
    console.error(err);
  }
}
</script>

</body>
</html>
	
	<!--======PART 4======== -->
