<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Login Teknisi ‚Äì PT PUTRA TIMUR JAYA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
body{margin:0;font-family:Poppins;background:#020617;color:#e5e7eb}
.container{max-width:1100px;margin:auto;padding:20px}
.card{background:#020617;border:1px solid #1f2937;border-radius:16px;padding:16px;margin-top:20px}
label{font-size:12px;margin-top:8px;display:block}
input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #374151;background:#020617;color:white;font-size:12px}
textarea{min-height:60px}
button{padding:8px 14px;border-radius:999px;border:none;font-size:12px;font-weight:600;cursor:pointer}
.btn-primary{background:#2563eb;color:white}
.btn-secondary{background:#0f172a;color:white;border:1px solid #334155}
.btn-danger{background:#dc2626;color:white}
.preview-small{max-width:120px;margin-top:6px;border-radius:8px;border:1px solid #374151;display:none}
.section-title{margin-top:16px;font-size:13px;font-weight:600;border-bottom:1px solid #1f2937;padding-bottom:4px}
#previewWrapper{display:none;margin-top:40px}
.a4{background:white;color:black;width:210mm;min-height:297mm;margin:auto;padding:18mm;font-size:11px}
.table{width:100%;border-collapse:collapse}
.table td{border:1px solid #00000033;padding:4px}
</style>
</head>

<body>
<div class="container">

<h2>Login Teknisi</h2>

<div class="card">
<label>User ID</label>
<input id="loginUser">
<label>Password</label>
<input id="loginPass" type="password">
<button class="btn-primary" onclick="loginTeknisi()">Login</button>
<p id="loginStatus"></p>
</div>

<div class="card" id="formCard" style="display:none">

<div class="section-title">Data Pribadi</div>
<label>Nama Pegawai</label>
<input id="namaPegawai">

<label>Tempat / Tanggal Lahir</label>
<input id="ttl">

<label>Jenis Kelamin</label>
<select id="jenisKelamin">
<option></option>
<option>Laki-laki</option>
<option>Perempuan</option>
</select>

<label>Pendidikan Terakhir</label>
<input id="pendidikanAkhir">

<label>Pendidikan Formal</label>
<textarea id="pendFormal"></textarea>

<label>Pendidikan Non Formal</label>
<textarea id="pendNonFormal"></textarea>

<div class="section-title">Data Pekerjaan</div>
<label>Status Perkawinan</label>
<select id="statusPerkawinan">
<option></option>
<option>Belum Menikah</option>
<option>Menikah</option>
<option>Cerai</option>
</select>

<label>Lokasi Kerja</label>
<input id="lokasiKerja">

<label>Posisi Kerja</label>
<input id="posisiKerja">

<label>Divisi</label>
<input id="divisi">

<div class="section-title">Dokumen Kendaraan</div>
<label>Nomor SIM C</label>
<input id="noSimC">

<label>Foto SIM C</label>
<input type="file" id="fotoSimC">
<img id="previewFotoSimC" class="preview-small">

<div class="section-title">Foto Utama</div>
<label>Foto Teknisi</label>
<input type="file" id="fotoTeknisi">
<img id="previewFotoTeknisi" class="preview-small">

<div style="margin-top:12px">
<button class="btn-primary" onclick="saveBiodata()">üíæ Simpan</button>
<button class="btn-secondary" onclick="showPreview()">üëÅ Preview</button>
<button class="btn-danger" onclick="logout()">Logout</button>
</div>

<p id="formStatus"></p>
</div>

<div id="previewWrapper">
<div class="a4">
<h3 style="text-align:center">BIODATA PEGAWAI</h3>
<table class="table">
<tr><td>Nama</td><td id="pvNama"></td></tr>
<tr><td>TTL</td><td id="pvTtl"></td></tr>
<tr><td>Jenis Kelamin</td><td id="pvJk"></td></tr>
<tr><td>No SIM C</td><td id="pvSim"></td></tr>
<tr><td>Foto</td><td><img id="pvFoto" style="max-width:120px"></td></tr>
<tr><td>Foto SIM C</td><td><img id="pvFotoSim" style="max-width:120px"></td></tr>
</table>
</div>
</div>

</div>

<script>
const WEB_APP_URL = "PASTE_WEB_APP_URL_KAMU";

/* USER SAMPLE */
const USERS=[
{username:"PTJ_Arip007",password:"alvaro007",nama:"ARIP RAHMATULLOH",divisi:"PIC",area:"CMI"}
];

let currentUser=null;
let fotoTeknisi="",fotoSimC="";

/* LOGIN */
function loginTeknisi(){
  const u=loginUser.value,p=loginPass.value;
  const f=USERS.find(x=>x.username===u&&x.password===p);
  if(!f){loginStatus.textContent="Login gagal";return;}
  currentUser=f;
  loginStatus.textContent="Login berhasil";
  formCard.style.display="block";
  namaPegawai.value=f.nama;
  divisi.value=f.divisi;
  lokasiKerja.value=f.area;
  loadExistingBiodata(f.username);
}

/* LOGOUT */
function logout(){
  currentUser=null;
  formCard.style.display="none";
  previewWrapper.style.display="none";
}

/* FILE */
function readFile(id,setter,preview){
  document.getElementById(id).onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{setter(r.result);preview.src=r.result;preview.style.display="block"}
    r.readAsDataURL(e.target.files[0]);
  }
}
readFile("fotoTeknisi",v=>fotoTeknisi=v,previewFotoTeknisi);
readFile("fotoSimC",v=>fotoSimC=v,previewFotoSimC);

/* SAVE */
async function saveBiodata(){
  formStatus.textContent="Menyimpan...";
  await fetch(WEB_APP_URL,{
    method:"POST",
    headers:{"Content-Type":"text/plain;charset=utf-8"},
    body:JSON.stringify({
      mode:"saveBiodata",
      user:currentUser,
      biodata:{
        namaPegawai:namaPegawai.value,
        ttl:ttl.value,
        jenisKelamin:jenisKelamin.value,
        pendidikanAkhir:pendidikanAkhir.value,
        pendFormal:pendFormal.value,
        pendNonFormal:pendNonFormal.value,
        statusPerkawinan:statusPerkawinan.value,
        lokasiKerja:lokasiKerja.value,
        posisiKerja:posisiKerja.value,
        divisi:divisi.value,
        noSimC:noSimC.value
      },
      foto:fotoTeknisi,
      fotoSimC:fotoSimC
    })
  });
  formStatus.textContent="Data tersimpan";
}

/* AUTOLOAD */
async function loadExistingBiodata(username){
  const r=await fetch(WEB_APP_URL,{
    method:"POST",
    headers:{"Content-Type":"text/plain;charset=utf-8"},
    body:JSON.stringify({mode:"getBiodata",username})
  });
  const j=await r.json();
  if(!j.ok)return;
  const d=j.biodata;
  ttl.value=d[4]||"";
  jenisKelamin.value=d[5]||"";
  pendidikanAkhir.value=d[6]||"";
  pendFormal.value=d[7]||"";
  pendNonFormal.value=d[8]||"";
  statusPerkawinan.value=d[9]||"";
  lokasiKerja.value=d[10]||"";
  posisiKerja.value=d[11]||"";
  divisi.value=d[12]||"";
  noSimC.value=d[36]||"";
  fotoTeknisi=d[37]||"";
  fotoSimC=d[43]||"";
  if(fotoTeknisi){previewFotoTeknisi.src=fotoTeknisi;previewFotoTeknisi.style.display="block"}
  if(fotoSimC){previewFotoSimC.src=fotoSimC;previewFotoSimC.style.display="block"}
}

/* PREVIEW */
function showPreview(){
  pvNama.textContent=namaPegawai.value;
  pvTtl.textContent=ttl.value;
  pvJk.textContent=jenisKelamin.value;
  pvSim.textContent=noSimC.value;
  pvFoto.src=fotoTeknisi;
  pvFotoSim.src=fotoSimC;
  previewWrapper.style.display="block";
}
</script>
</body>
</html>
